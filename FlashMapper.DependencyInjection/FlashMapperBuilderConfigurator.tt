<#@ template debug="false" hostspecific="false" language="C#" #>
<#@ assembly name="System.Core" #>
<#@ import namespace="System.Linq" #>
<#@ import namespace="System.Text" #>
<#@ import namespace="System.Collections.Generic" #>
<#@ output extension=".cs" #>
<# 
	var maxNumberOfSources = 14;
	var sourceTypePrefix = "Source";
#>
//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated from a template.
//
//     Manual changes to this file may cause unexpected behavior in your application.
//     Manual changes to this file will be overwritten if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------

using System;
using System.Linq.Expressions;
using FlashMapper.MultiSource;

namespace FlashMapper.DependencyInjection
{
<#  for (var i = 0; i < maxNumberOfSources; i++)
    {
		var sourcesTypesString = string.Join(", ", Enumerable.Range(1, i + 1)
			.Select(n => $"T{sourceTypePrefix}{n}"));
#>
    internal class FlashMapperBuilderConfigurator<<#= sourcesTypesString #>, TDestination, TBuilder> : IFlashMapperBuilderConfigurator<<#= sourcesTypesString #>, TDestination>
    {
        private readonly IFlashMapperBuilderConfiguratorContext context;
        private readonly TBuilder builder;
        public FlashMapperBuilderConfigurator(IFlashMapperBuilderConfiguratorContext context, TBuilder builder)
        {
            this.context = context;
			this.builder = builder;
        }

<#  if (i < maxNumberOfSources - 1)
	{
		var newParameterSourceTypeName = $"T{sourceTypePrefix}{i+2}";
		var sourcesTypesWithNewParameterString = $"{sourcesTypesString}, {newParameterSourceTypeName}";
#>
		public IFlashMapperBuilderConfigurator<<#= sourcesTypesWithNewParameterString #>, TDestination> ResolveExtraParameter<<#= newParameterSourceTypeName #>>(Expression<Func<<#= sourcesTypesWithNewParameterString #>>> resolveParameterMethod)
		{
		    Func<IMappingConfiguration, Expression<Func<<#= sourcesTypesString #>, TBuilder, TDestination>>, Func<IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>, IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>>, IMappingConfiguration> createMappingMethod = FlashMapperMultiSourceExtensions.CreateMapping;
            Func<IMappingConfiguration, <#= sourcesTypesWithNewParameterString #>, TBuilder, TDestination> convertMethod = FlashMapperMultiSourceExtensions.Convert<<#= sourcesTypesWithNewParameterString #>, TBuilder, TDestination>;
			Action<IMappingConfiguration, <#= sourcesTypesWithNewParameterString #>, TBuilder, TDestination> mapDataMethod = FlashMapperMultiSourceExtensions.MapData;
			var serviceRegistrationHelper = new ServiceRegistrationHelper<IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>>();
			var step = new ResolveExtraParameterStep(resolveParameterMethod, convertMethod.Method, mapDataMethod.Method, createMappingMethod.Method, serviceRegistrationHelper);
			context.Steps.Add(step);
			return new FlashMapperBuilderConfigurator<<#= sourcesTypesWithNewParameterString #>, TDestination, TBuilder>(context, builder);
		}
<#
	}
#>

        public IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TDestination> CreateMapping(Expression<Func<<#= sourcesTypesString #>, TDestination>> mappingExpression)
        {
			Func<IMappingConfiguration, Expression<Func<<#= sourcesTypesString #>, TBuilder, TDestination>>, Func<IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>, IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>>, IMappingConfiguration> createMappingMethod = FlashMapperMultiSourceExtensions.CreateMapping;
            var settings = new DeferredFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TDestination, TBuilder>(builder);
            Func<IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>, IFlashMapperMappingConfigurator<<#= sourcesTypesString #>, TBuilder, TDestination>> internalSettingsInitializer = settings.Initialize;
			var step = new ResultMappingConfigStep(mappingExpression, createMappingMethod.Method, internalSettingsInitializer);
			context.Steps.Add(step);
            return settings;
        }
    }

<#  } #>
<#	
	var delegateGenericArgumentPrefix = "T";
	var delegateParameterPrefix = "t";
	var delegateNumberOfArguments = 17;
	var delegateParameters = Enumerable.Range(1, delegateNumberOfArguments)
		.Select(i => new 
		{
			GenericTypeArgument = $"{delegateGenericArgumentPrefix}{i}",
			Parameter = $"{delegateParameterPrefix}{i}"
		});
	var delegateGenericArgumentsString = string.Join(",", delegateParameters.Select(p => $"in {p.GenericTypeArgument}"));
	var delegateParametersString = string.Join(", ", delegateParameters.Select(p => $"{p.GenericTypeArgument} {p.Parameter}"));
#>	
	internal delegate void Action<<#= delegateGenericArgumentsString #>>(<#= delegateParametersString #>);
}